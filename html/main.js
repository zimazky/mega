!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e),i.d(e,"turnPwrCtrl",(function(){return x}));class s{constructor(t,e="stepped"){this.time=t,this.zmode=e,this.data=[],this.flag=0,this.value=0,this.high=Number.MIN_VALUE,this.low=Number.MAX_VALUE,this.open=0,this.close=0,this.topen=0,this.tclose=0,this.nclose=0,this.tstep=0,this.zdata=[]}push(t){if(!(t.time<this.time))if(0==this.data.length)this.flag=1,this.value=this.low=this.high=this.open=this.close=t.value,this.topen=this.tclose=t.time,this.data.push({flag:0,time:t.time,value:t.value});else{if(this.tclose>this.topen&&(this.value=(this.value*(this.tclose-this.topen)+(this.close-this.open)*(t.time-this.tclose))/(t.time-this.topen)),this.close==t.value&&1==t.flag)return void(0==this.nclose?(this.nclose++,this.tclose=t.time,this.data.push({flag:t.flag,time:t.time,value:t.value})):(this.data[this.data.length-1].time=t.time,this.tclose=t.time));this.low=Math.min(this.low,t.value),this.high=Math.max(this.high,t.value),this.close=t.value,this.tclose=t.time,this.nclose=0,this.data.push({flag:t.flag,time:t.time,value:t.value})}}getlinearregdata(t){for(var e=[],i=this.data[0],s=this.time,a=i.value;s+t<i.time;)e.push({flag:0,value:a}),s+=t;e.push({flag:1,value:a});for(var h=1;h<this.data.length;h++){i=this.data[h];var n=e.length-1,r=this.data[h-1];if(i.time<s+t)e[n].value+=(i.value-a)*(s+t-i.time)/t,a=i.value;else{s+=t;var o=(i.value-r.value)/(i.time-r.time);for(a=r.value+o*(s-r.time);s+t<i.time;){var l=a+o*t;e.push({flag:i.flag,value:(a+l)/2}),a=l,s+=t}e.push({flag:1,value:a})}}return e}getsteppedregdata(t){for(var e=[],i=this.data[0],s=this.time,a=i.value;s+t<i.time;)e.push({flag:0,value:a}),s+=t;e.push({flag:1,value:a});for(var h=1;h<this.data.length;h++){i=this.data[h];var n=e.length-1,r=this.data[h-1];if(i.time<s+t)e[n].value+=(i.value-a)*(s+t-i.time)/t,a=i.value;else{for(s+=t,a=r.value;s+t<i.time;)e.push({flag:i.flag,value:a}),s+=t;0==i.flag&&(a=i.value),e.push({flag:1,value:a})}}return e.push({flag:1,value:a}),e}getohlcregdata(t){for(var e=[],i=this.data[0],s=this.time,a=i.value;s+t<i.time;)e.push({flag:0,open:a,high:a,low:a,close:a}),s+=t;e.push({flag:1,open:a,high:a,low:a,close:a});for(var h=1;h<this.data.length;h++){i=this.data[h];var n=e.length-1,r=this.data[h-1];if(i.time<s+t)e[n].close=i.value,e[n].high=i.value>e[n].high?i.value:e[n].high,e[n].low=i.value<e[n].low?i.value:e[n].low;else{for(s+=t,a=r.value;s+t<i.time;)e.push({flag:i.flag,open:a,high:a,low:a,close:a}),s+=t;0==i.flag&&(a=i.value),e.push({flag:1,open:a,high:a,low:a,close:a})}}return e.push({flag:1,open:a,high:a,low:a,close:a}),e}gethighlowregdata(t){for(var e=[],i=this.data[0],s=this.time,a=i.value;s+t<i.time;)e.push({flag:0,high:a,low:a}),s+=t;e.push({flag:1,high:a,low:a});for(var h=1;h<this.data.length;h++){i=this.data[h];var n=e.length-1,r=this.data[h-1];if(i.time<s+t)e[n].high=i.value>e[n].high?i.value:e[n].high,e[n].low=i.value<e[n].low?i.value:e[n].low;else{for(s+=t,a=r.value;s+t<i.time;)e.push({flag:i.flag,high:a,low:a}),s+=t;0==i.flag&&(a=i.value),e.push({flag:1,high:a,low:a})}}return e.push({flag:1,high:a,low:a}),e}rezoom(t){t<1&&(t=1),this.tstep!=t&&0!=this.data.length&&(this.tstep=t,"linear"==this.zmode?this.zdata=this.getlinearregdata(t):"stepped"==this.zmode?this.zdata=this.getsteppedregdata(t):"highlow"==this.zmode?this.zdata=this.gethighlowregdata(t):"ohlc"==this.zmode&&(this.zdata=this.getohlcregdata(t)))}fillzdata(t,e,i){if(this.tclose<=t.begin||this.topen>=t.end)return i;this.rezoom(e);var s=t.begin,a=~~((t.begin-this.time)/e),h=0;a<0&&(s=this.time,h=-a,a=0);var n=i.min,r=i.max;if("linear"==this.zmode||"stepped"==this.zmode)for(;s<t.end&&s<this.tclose;a++,h++,s+=e){var o=this.zdata[a].flag;i.zdata[h].flag=o;var l=this.zdata[a].value;i.zdata[h].value=l,1==o&&(n=l<n?l:n,r=l>r?l:r)}else if("highlow"==this.zmode)for(;s<t.end&&s<this.tclose;a++,h++,s+=e){o=this.zdata[a].flag;i.zdata[h].flag=o;var u=this.zdata[a].high,c=this.zdata[a].low;i.zdata[h].high=u,i.zdata[h].low=c,1==o&&(n=c<n?c:n,r=u>r?u:r)}else if("ohlc"==this.zmode)for(;s<t.end&&s<this.tclose;a++,h++,s+=e){o=this.zdata[a].flag;i.zdata[h].flag=o;var d=this.zdata[a].open,g=(u=this.zdata[a].high,c=this.zdata[a].low,this.zdata[a].close);i.zdata[h].open=d,i.zdata[h].high=u,i.zdata[h].low=c,i.zdata[h].close=g,1==o&&(n=c<n?c:n,r=u>r?u:r)}return{zdata:i.zdata,min:n,max:r}}integrate(t){var e=0;if(this.data.length>0)for(var i=this.data[0],s=1;s<this.data.length;s++){var a=this.data[s];a.time>t.begin&&a.time<=t.end&&(e+=i.value*(a.time-i.time),i=a)}return e}clearzdata(){this.zdata=[],this.tstep=0}}class a{constructor(t,e){this.url=t,this.ext=e,this.array=[],this.tryes=[],this.parse=function(t,e,i){return{time:t,status:0}},this.onload=function(){},this.ondock=function(t,e){}}load(t,e,i="json"){if(!a.loading&&void 0===this.array[t]){var s=86400*~~((Date.now()/1e3+10800)/86400)-10800;if(!(t>s)){a.loading=!0;var h=new Date(1e3*(t+10800)),n=h.getUTCDate(),r=h.getUTCMonth()+1,o=h.getUTCFullYear(),l=this.url+o+(r<10?"0":"")+r+(n<10?"0":"")+n+"."+this.ext,u=new XMLHttpRequest;u.responseType=i,u.open("GET",l,!0),u.onreadystatechange=function(i){4==u.readyState&&(200==u.status?(this.array[t]=this.parse(t,u.response,e),delete this.tryes[t],void 0!==this.array[t+86400]&&0!=this.array[t+86400].flag&&this.ondock(this.array[t],this.array[t+86400]),void 0!==this.array[t-86400]&&0!=this.array[t-86400].flag&&this.ondock(this.array[t-86400],this.array[t])):0!=u.status?(console.log("loading error",u.statusText),console.log("status",u.status),this.array[t]={flag:0}):(void 0===this.tryes[t]?this.tryes[t]=1:this.tryes[t]+=1,console.log("trying",this.tryes[t]),this.tryes[t]>3&&(this.array[t]={flag:0},delete this.tryes[t])),a.loading=!1,this.onload())}.bind(this),u.send(null),console.log(l)}}}preparezdata(t,e){for(var i=Number.MAX_VALUE,s=Number.MIN_VALUE,a=[],h=t.begin;h<t.end;h+=e)a.push({flag:0});return{zdata:a,min:i,max:s}}getzdata(t,e){for(var i=this.preparezdata(t,e),s=86400*~~((t.begin+10800)/86400)-10800;s<t.end;s+=86400)void 0===this.array[s]?this.load(s,e,"text"):0!=this.array[s].flag&&(i=this.array[s].fillzdata(t,e,i));return i}}function h(t,e=512,i=384){this.container=document.getElementById(t),this._canvas=document.createElement("canvas"),this.container.appendChild(this._canvas),this._canvas.width=e,this._canvas.height=i,this._ctx=this._canvas.getContext("2d"),this.width=this._canvas.width,this.height=this._canvas.height,this.lines=function(t,e,i,s,a,h,n,r,o,l=0,u="black"){var c;if(l<0?(c=-l*(a+h),l=0):(c=l,c=((l=~~(l+.5))-c)*(a+h)),!(c>=i||l>=n.length)){var d=~~((i-c)/(a+h));d=d<n.length-l?d:n.length-l;var g=s/(o-r);this._ctx.save(),this._ctx.strokeStyle=u,this._ctx.beginPath();var f=.5+~~(t+c),m=e+s-g*(n[l].value-r);this._ctx.moveTo(f,.5+~~m),1==n[l].flag?this._ctx.lineTo(f+(a+h),.5+~~m):this._ctx.moveTo(f+(a+h),.5+~~m);for(var v=1;v<d;v++)f=.5+~~(t+c+v*(a+h)),m=e+s-g*(n[l+v].value-r),1==n[l+v].flag&&(1==n[l+v-1].flag||this._ctx.moveTo(f,.5+~~m),this._ctx.lineTo(f+(a+h),.5+~~m));this._ctx.stroke(),this._ctx.restore()}},this.stepped=function(t,e,i,s,a,h,n,r,o,l=0,u="black"){var c;if(l<0?(c=-l*(a+h),l=0):(c=l,c=((l=~~(l+.5))-c)*(a+h)),!(c>=i||l>=n.length)){var d=~~((i-c)/(a+h));d=d<n.length-l?d:n.length-l;var g=s/(o-r);this._ctx.save(),this._ctx.strokeStyle=u,this._ctx.beginPath();var f=.5+~~(t+c),m=e+s-g*(n[l].value-r);this._ctx.moveTo(f,.5+~~m),1==n[l].flag?this._ctx.lineTo(f+(a+h),.5+~~m):this._ctx.moveTo(f+(a+h),.5+~~m);for(var v=1;v<d;v++)f=.5+~~(t+c+v*(a+h)),m=e+s-g*(n[l+v].value-r),1==n[l+v].flag&&(1==n[l+v-1].flag?(this._ctx.lineTo(f,.5+~~m),this._ctx.lineTo(f+(a+h),.5+~~m)):(this._ctx.moveTo(f,.5+~~m),this._ctx.lineTo(f+(a+h),.5+~~m)));this._ctx.stroke(),this._ctx.restore()}},this.ohlcbars=function(t,e,i,s,a,h,n,r,o,l=0,u="green",c="red"){var d;if(l<0?(d=-l*(a+h),l=0):(d=l,d=((l=~~(l+.5))-d)*(a+h)),!(d>=i||l>=n.length)){var g=~~((i-d)/(a+h));g=g<n.length-l?g:n.length-l-1;var f=s/(o-r);this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=u;for(var m=.5+~~(t+d),v=0;v<=g;v++,m+=a+h){var p=e+s-f*(n[l+v].open-r),x=e+s-f*(n[l+v].high-r),z=e+s-f*(n[l+v].low-r),_=e+s-f*(n[l+v].close-r);1==n[l+v].flag&&_<=p&&(this._ctx.moveTo(m,.5+~~_),this._ctx.lineTo(m-(a+h>>1),.5+~~_),this._ctx.moveTo(m-(a+h>>1),.5+~~p),this._ctx.lineTo(m-(a+h),.5+~~p),this._ctx.moveTo(m-(a+h>>1),.5+~~x),this._ctx.lineTo(m-(a+h>>1),.5+~~z))}this._ctx.stroke(),this._ctx.beginPath(),this._ctx.strokeStyle=c,m=.5+~~(t+d);for(v=0;v<=g;v++,m+=a+h){p=e+s-f*(n[l+v].open-r),x=e+s-f*(n[l+v].high-r),z=e+s-f*(n[l+v].low-r),_=e+s-f*(n[l+v].close-r);1==n[l+v].flag&&_>p&&(this._ctx.moveTo(m,.5+~~_),this._ctx.lineTo(m-(a+h>>1),.5+~~_),this._ctx.moveTo(m-(a+h>>1),.5+~~p),this._ctx.lineTo(m-(a+h),.5+~~p),this._ctx.moveTo(m-(a+h>>1),.5+~~x),this._ctx.lineTo(m-(a+h>>1),.5+~~z))}this._ctx.stroke(),this._ctx.restore()}},this.highlowbars=function(t,e,i,s,a,h,n,r,o,l=0,u="black"){var c;if(l<0?(c=-l*(a+h),l=0):(c=l,c=((l=~~(l+.5))-c)*(a+h)),!(c>=i||l>=n.length)){var d=~~((i-c)/(a+h));d=d<n.length-l?d:n.length-l-1;var g=s/(o-r);this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=u;for(var f=.5+~~(t+c),m=0;m<=d;m++,f+=a+h){var v=e+s-g*(n[l+m].high-r),p=e+s-g*(n[l+m].low-r);1==n[l+m].flag&&(this._ctx.moveTo(f-(a+h>>1),.5+~~v),this._ctx.lineTo(f-(a+h>>1),.5+~~p))}this._ctx.stroke(),this._ctx.restore()}},this.y_axis=function(t,e,i,s,a,h,n=20,r,o="gray"){var l=(h-a)/(s/n),u=Math.log(l)/Math.log(10);u=u<0?~~(u-1):~~(u+.5);var c=Math.pow(10,u),d=l/c;d<=1?d=1:d<=1.25?(d=1.25,u-=2):d<=2.5?(d=2.5,u--):d<=2?d=2:d<=5?d=5:(d=10,u++),u=u<0?-u:0;var g=c*d,f=g*~~(a/g+1),m=s/(h-a);this._ctx.save(),this._ctx.strokeStyle=r,this._ctx.lineWidth=1,this._ctx.fillStyle=o,this._ctx.font="10px verdana",this._ctx.textAlign="right",this._ctx.textBaseline="bottom";for(var v=f;v<=h;v+=g){var p=.5+~~(e+s-m*(v-a));this._ctx.beginPath(),this._ctx.moveTo(t,p),this._ctx.lineTo(t+i,p),this._ctx.stroke(),this._ctx.fillText(v.toFixed(u),t+i-2,p)}this._ctx.restore()},this.timezone=3,this.timeunits=[{value:1,qt:1,unit:"s",shift:3600*this.timezone},{value:2,qt:1,unit:"s",shift:3600*this.timezone},{value:5,qt:1,unit:"s",shift:3600*this.timezone},{value:10,qt:1,unit:"s",shift:3600*this.timezone},{value:20,qt:1,unit:"s",shift:3600*this.timezone},{value:30,qt:1,unit:"s",shift:3600*this.timezone},{value:60,qt:60,unit:"m",shift:3600*this.timezone},{value:120,qt:60,unit:"m",shift:3600*this.timezone},{value:300,qt:60,unit:"m",shift:3600*this.timezone},{value:600,qt:60,unit:"m",shift:3600*this.timezone},{value:1200,qt:60,unit:"m",shift:3600*this.timezone},{value:1800,qt:60,unit:"m",shift:3600*this.timezone},{value:3600,qt:3600,unit:"h",shift:3600*this.timezone},{value:7200,qt:3600,unit:"h",shift:3600*this.timezone},{value:10800,qt:3600,unit:"h",shift:3600*this.timezone},{value:21600,qt:3600,unit:"h",shift:3600*this.timezone},{value:43200,qt:3600,unit:"h",shift:3600*this.timezone},{value:86400,qt:86400,unit:"d",shift:3600*this.timezone},{value:172800,qt:86400,unit:"d",shift:3600*this.timezone},{value:604800,qt:604800,unit:"w",shift:259200+3600*this.timezone},{value:1209600,qt:604800,unit:"w",shift:259200+3600*this.timezone},{value:2419200,qt:604800,unit:"w",shift:259200+3600*this.timezone}],this.time_grid=function(t,e,i,s,a,h,n=50,r="gray",o="gray"){var l,u=n*(h-a)/i;for(l=0;l<this.timeunits.length&&u>this.timeunits[l].value;l++);l=0==l?0:l-1;var c=this.timeunits[l].value,d=~~((a+this.timeunits[l].shift)/c+1)*c-this.timeunits[l].shift,g=i/(h-a);this._ctx.save(),this._ctx.strokeStyle=r,this._ctx.lineWidth=1,this._ctx.fillStyle=o,this._ctx.font="10px verdana",this._ctx.textBaseline="top";var f=new Date(1e3*(a+3600*this.timezone)),m=f.getUTCHours(),v=f.getUTCDate(),p=f.getUTCMonth()+1,x=f.getUTCFullYear();if("d"==this.timeunits[l].unit||"w"==this.timeunits[l].unit)for(var z=new Date(1e3*(a+3600*this.timezone)),_=0,w=a;w<h;_++){var b=z.getUTCMonth()+1,y=z.getUTCFullYear();z.setUTCHours(0),z.setMinutes(0),z.setSeconds(0),z.setUTCDate(1),z.setUTCMonth(b),b=z.getUTCMonth()+1,y=z.getUTCFullYear();var T=.5+~~(t+((w=z.getTime()/1e3-3600*this.timezone)-a)*g);0==_&&T-t>60&&this._ctx.fillText(x+"."+(p<10?"0":"")+p+"."+(v<10?"0":"")+v,0,0);var M=y+"."+(b<10?"0":"")+b;this._ctx.beginPath(),this._ctx.moveTo(T,e),this._ctx.lineTo(T,e+12),this._ctx.stroke(),this._ctx.fillText(M,T,0)}else if("h"==this.timeunits[l].unit)for(_=0,w=a;w<h;w+=86400,_++){0==_&&(w=86400*~~((a+this.timeunits[l].shift)/86400+1)-this.timeunits[l].shift);T=.5+~~(t+(w-a)*g);0==_&&T-t>60&&this._ctx.fillText(x+"."+(p<10?"0":"")+p+"."+(v<10?"0":"")+v,0,0);var U=(z=new Date(1e3*(w+3600*this.timezone))).getUTCDate();b=z.getUTCMonth()+1,M=(y=z.getUTCFullYear())+"."+(b<10?"0":"")+b+"."+(U<10?"0":"")+U;this._ctx.beginPath(),this._ctx.moveTo(T,e),this._ctx.lineTo(T,e+12),this._ctx.stroke(),this._ctx.fillText(M,T,0)}else if("m"==this.timeunits[l].unit)for(_=0,w=a;w<h;w+=3600,_++){0==_&&(w=3600*~~((a+this.timeunits[l].shift)/3600+1)-this.timeunits[l].shift);T=.5+~~(t+(w-a)*g);0==_&&T-t>95&&this._ctx.fillText(x+"."+(p<10?"0":"")+p+"."+(v<10?"0":"")+v+" "+(m<10?"0":"")+m+":00",0,0);var E=(z=new Date(1e3*(w+3600*this.timezone))).getUTCHours();U=z.getUTCDate(),b=z.getUTCMonth()+1,y=z.getUTCFullYear(),M=(b<10?"0":"")+b+"."+(U<10?"0":"")+U+" "+(E<10?"0":"")+E+"h";this._ctx.beginPath(),this._ctx.moveTo(T,e),this._ctx.lineTo(T,e+12),this._ctx.stroke(),this._ctx.fillText(M,T,0)}for(var C=d;C<h;C+=c){T=.5+~~(t+(C-a)*g);this._ctx.beginPath(),this._ctx.moveTo(T,e+12),this._ctx.lineTo(T,e+s),this._ctx.stroke();z=new Date(1e3*(C+3600*this.timezone));if("s"==this.timeunits[l].unit){var I=z.getUTCSeconds();M=(I<10?"0":"")+I+"''";this._ctx.fillText(M,T,12)}else if("m"==this.timeunits[l].unit){M=((b=z.getUTCMinutes())<10?"0":"")+b+"'";this._ctx.fillText(M,T,12)}else if("h"==this.timeunits[l].unit){M=((E=z.getUTCHours())<10?"0":"")+E+"h";this._ctx.fillText(M,T,12)}else if("d"==this.timeunits[l].unit){M=((U=z.getUTCDate())<10?"0":"")+U;this._ctx.fillText(M,T,12)}else if("w"==this.timeunits[l].unit){U=z.getUTCDate(),b=z.getUTCMonth()+1,M=(U<10?"0":"")+U;this._ctx.fillText(M,T,12)}}this._ctx.restore()},this.clear=function(){this._ctx.clearRect(0,0,this.width,this.height)}}a.loading=!1;class n{constructor(t,e,i,s,a=0,n=40,r=0,o=2){this.width=e-a-n,this.height=i-25-0,this.marginleft=a,this.marginright=n,this.barw=r,this.barp=o,this.t=s,this.tstep=(this.t.end-this.t.begin)/this.width*(this.barw+this.barp),this.graph=new h(t,e,i),this.graph._canvas.addEventListener("mousewheel",function(t){t.preventDefault(),t=t||window.event;var e=Math.pow(.9,t.detail?t.detail>0?-1:1:t.wheelDelta>0?1:-1),i=(t.offsetX-this.marginleft)/this.width;this.t.zoom(e,i)}.bind(this),!1),this.isDragging=!1,this.clientX0=0,this.graph._canvas.addEventListener("mousedown",function(t){t.preventDefault(),this.isDragging=!0,this.clientX0=t.offsetX}.bind(this),!1),this.graph._canvas.addEventListener("mousemove",function(t){if(t.preventDefault(),this.isDragging){var e=(t.offsetX-this.clientX0)/(this.barw+this.barp);this.clientX0=t.offsetX,this.t.shift(-e*this.tstep)}}.bind(this),!1),this.graph._canvas.addEventListener("mouseup",function(t){t.preventDefault(),this.isDragging=!1}.bind(this),!1)}rezoom(){this.tstep=(this.t.end-this.t.begin)/this.width*(this.barw+this.barp)}redraw(){this.tstep=(this.t.end-this.t.begin)/this.width*(this.barw+this.barp),this.graph.clear(),this.graph.time_grid(0,0,this.width,this.height+25,this.t.begin,this.t.end,60,"#666666"),this.graph._ctx.save(),this.graph._ctx.fillStyle="grey",this.graph._ctx.font="10px verdana",this.graph._ctx.textBaseline="bottom",this.graph._ctx.restore()}}class r extends a{constructor(t,e,i,a,h){super(t,"Z"+e),this.tcolor=i,this.hcolor=a,this.pcolor=h,this.showpower=!1,this.parse=function(t,e,i){var a=new s(t),h=new s(t),n=new s(t);if(e){for(var r=e.split("\n"),o=0,l=(t=0,0),u=0,c=0,d=0,g=0,f=0,m=0;m<r.length;m++){var v=r[m].split(";");if(!(v.length<2))if(128&v[0]){t=0,l=0,u=0,c=0,g=0,o=parseInt(v[1]);var p=2;1&v[0]&&(t=parseFloat(v[p++])),2&v[0]&&(l=parseFloat(v[p++])),d=4&v[0]?100:0,n.push({flag:1,time:o,value:d}),16&v[0]&&(u=parseFloat(v[p++])),32&v[0]&&(c=parseFloat(v[p++])),64&v[0]&&(g=parseFloat(v[p++])),0==g&&(a.push({flag:0,time:o,value:t/10}),h.push({flag:0,time:o,value:l/10}))}else{if(0==o)continue;var x=parseInt(v[1]);(x=x>2147483647?x-4294967296:x)<0&&console.log(x,o,t,l,u,c,g),o+=x;p=2;1&v[0]&&(t+=parseFloat(v[p++])),2&v[0]&&(l+=parseFloat(v[p++])),4&v[0]?100!=d&&(d=100,n.push({flag:1,time:o,value:d})):0!=d&&(d=0,n.push({flag:1,time:o,value:d})),16&v[0]&&(u+=parseFloat(v[p++])),32&v[0]&&(c+=parseFloat(v[p++])),64&v[0]&&(g=parseFloat(v[p++])),f=0==g?1:0,0==g&&(1&v[0]&&a.push({flag:f,time:o,value:t/10}),2&v[0]&&h.push({flag:f,time:o,value:l/10}))}}0!=a.data.length&&a.push({flag:f,time:o,value:t/10}),0!=h.data.length&&h.push({flag:f,time:o,value:l/10}),0!=n.data.length&&n.push({flag:1,time:o,value:d})}return{t:a,h:h,p:n}}}preparezdata(t,e){for(var i={zdata:[],min:Number.MAX_VALUE,max:Number.MIN_VALUE},s={zdata:[],min:Number.MAX_VALUE,max:Number.MIN_VALUE},a={zdata:[],min:Number.MAX_VALUE,max:Number.MIN_VALUE},h=t.begin;h<t.end;h+=e)i.zdata.push({flag:0}),s.zdata.push({flag:0}),a.zdata.push({flag:0});return{t:i,h:s,p:a}}getzdata(t,e){for(var i=this.preparezdata(t,e),s=86400*~~((t.begin+10800)/86400)-10800;s<t.end;s+=86400)void 0===this.array[s]?this.load(s,e,"text"):0!=this.array[s].flag&&(i.t=this.array[s].t.fillzdata(t,e,i.t),i.h=this.array[s].h.fillzdata(t,e,i.h),i.p=this.array[s].p.fillzdata(t,e,i.p));return i}}class o extends n{constructor(t,e,i,s,a,h=0,n=40,r=0,o=2){super(e,i,s,a,h,n,r,o),this.zones=t}redraw(t){super.redraw();for(var e=Number.MAX_VALUE,i=Number.MIN_VALUE,s=[],a=0;a<t.length;a++)s.push(t[a]),e=e<s[a].t.min?e:s[a].t.min,i=i>s[a].t.max?i:s[a].t.max;this.graph.y_axis(this.marginleft,25,this.marginleft+this.width+this.marginright,this.height,e,i,18,"#666666");for(a=0;a<this.zones.length;a++)this.zones[a].showpower&&this.graph.stepped(this.marginleft,25,this.width,this.height,this.barw,this.barp,s[a].p.zdata,0,100,0,this.zones[a].pcolor),this.graph.stepped(this.marginleft,25,this.width,this.height,this.barw,this.barp,s[a].t.zdata,e,i,0,this.zones[a].tcolor)}}class l extends n{constructor(t,e,i,s,a,h=0,n=40,r=0,o=2){super(e,i,s,a,h,n,r,o),this.zones=t}redraw(t){super.redraw();for(var e=Number.MAX_VALUE,i=Number.MIN_VALUE,s=[],a=0;a<t.length;a++)s.push(t[a]),e=e<s[a].h.min?e:s[a].h.min,i=i>s[a].h.max?i:s[a].h.max;this.graph.y_axis(this.marginleft,25,this.marginleft+this.width+this.marginright,this.height,e,i,18,"#666666");for(a=0;a<this.zones.length;a++)this.zones[a].showpower&&this.graph.stepped(this.marginleft,25,this.width,this.height,this.barw,this.barp,s[a].p.zdata,0,100,0,this.zones[a].pcolor),this.graph.stepped(this.marginleft,25,this.width,this.height,this.barw,this.barp,s[a].h.zdata,e,i,0,this.zones[a].hcolor)}}class u extends n{constructor(t,e,i,s,a,h=0,n=40,r=0,o=2){super(e,i,s,a,h,n,r,o),this.zones=t}abshumiditycalc(t){for(var e=Number.MAX_VALUE,i=Number.MIN_VALUE,s=[],a=0;a<t.h.zdata.length;a++){var h=t.t.zdata[a].flag,n=t.t.zdata[a].value;if(0==h)s.push({flag:0});else{var r=1e6*(n<0?Math.exp((18.74*n-115.72)/(233.77+.881*n)):Math.exp((16.57*n-115.72)/(233.77+.997*n)))/(461.52*(273.15+n));e=e<(r*=.01*t.h.zdata[a].value)?e:r,i=i>r?i:r,s.push({flag:h,value:r})}}return{zdata:s,min:e,max:i}}redraw(t){super.redraw();for(var e=Number.MAX_VALUE,i=Number.MIN_VALUE,s=[],a=0;a<this.zones.length;a++)s.push(this.abshumiditycalc(t[a])),e=e<s[a].min?e:s[a].min,i=i>s[a].max?i:s[a].max;this.graph.y_axis(this.marginleft,25,this.marginleft+this.width+this.marginright,this.height,e,i,18,"#666666");for(a=0;a<this.zones.length;a++)this.graph.stepped(this.marginleft,25,this.width,this.height,this.barw,this.barp,s[a].zdata,e,i,0,this.zones[a].hcolor)}}var c="http://192.168.2.2";window.addEventListener("load",(function(){setInterval((function(){var t=new Date,e=new Intl.DateTimeFormat("ru",{hour:"numeric",minute:"numeric",second:"numeric"});document.getElementById("time").innerText=e.format(t),e=new Intl.DateTimeFormat("ru",{year:"numeric",month:"long",day:"numeric"}),document.getElementById("date").innerText=e.format(t)}),1e3)}),!1);var d=~~(Date.now()/1e3),g=new class{constructor(t,e,i=function(){},s=function(){}){this.begin=t,this.end=e,this.onshift=i,this.onzoom=s}shift(t){this.begin+=t,this.end+=t,this.onshift()}zoom(t,e=0){if(!(t*(this.end-this.begin)<300)){var i=this.begin+e*(this.end-this.begin);this.begin=i-t*(i-this.begin),this.end=i+t*(this.end-i),this.onzoom()}}}(d-86400,d),f=new class{constructor(t,e,i){this.ti=e,this.url=t,this.container=document.getElementById(i),this.zones=[],this.add_zone(1,"#ffa23c","#bbbbbb","#00C0C0"),this.add_zone(2,"#ffa23c","#bbbbbb","#00C0C0"),this.add_zone(3,"#88a23c","#88bbbb","#00C0C0"),this.diagrams=[],this.diagrams.push(new o(this.zones,"zonediagt",260,160,this.ti)),this.diagrams.push(new l(this.zones,"zonediagh",260,160,this.ti)),this.diagrams.push(new u(this.zones,"zonediagf",260,160,this.ti)),this.getinfo(function(t){var e=this.parseinfo(t);document.getElementById("loading").style.display="none",this.updateinfo(e),setInterval(function(){this.getinfo(function(t){this.updateinfo(this.parseinfo(t))}.bind(this),c)}.bind(this),1e4)}.bind(this),c)}getinfo(t=function(t){},e="."){var i=new XMLHttpRequest;i.open("GET",e+"/?g:i&r="+Math.random(),!0),i.onload=function(){document.getElementById("controllerinfo").innerText=this.responseText,t(this.responseText)},i.send(null)}parseinfo(t){for(var e=t.split(";"),i=parseInt(e[1]),s=[],a=0;a<i;a++){var h=7*a;s[a]={t:parseInt(e[8+h]),tc:parseInt(e[9+h]),h:parseInt(e[10+h]),m:parseInt(e[11+h]),p:parseInt(e[12+h]),dt:parseInt(e[13+h]),s:parseInt(e[14+h])}}return{version:e[0],numofz:i,unixtime:parseInt(e[2]),starttime:parseInt(e[3]),lastsynctime:parseInt(e[4]),lastsyncdelta:parseInt(e[5]),lastsyncinterval:parseInt(e[6]),tickcounter:parseInt(e[7]),zones:s}}add_zone(t,e,i,s){this.zones.push(new r(this.url,t,e,i,s)),this.zones[this.zones.length-1].onload=p,this.container.innerHTML+=`\n\t\t\t<div class="controlbox" id="arduinocontrol-${t}">\n\t\t\t\t<div class="header"><div class="indicator"></div> ZONE ${t}</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class="button pwrctrl" onclick="turnPwrCtrl(this,${t})">PWRCTRL</div>\n\t\t\t\t\t<div class="button pwr">PWR</div>\n\t\t\t\t\t<div class="button">CONFIG</div>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class="button" onclick="turnShowPwr(this,${t})">SHOWPWR</div>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class="parameter temperature button" onclick="modalOpen(this,${t})">\n\t\t\t\t\t\t<div class="name">temperature</div>\n\t\t\t\t\t\t<div class="value">0.0°(0.0°)</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="parameter humidity">\n\t\t\t\t\t\t<div class="name">humidity</div>\n\t\t\t\t\t\t<div class="value">0.0%</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="sensorstatus"></div>\n\t\t\t</div>`}updateinfo(t){document.getElementById("firmware").innerText="ver "+t.version,document.getElementById("controllertime").innerText=function(t){var e=new Date(1e3*t),i=e.getMonth()+1,s=e.getDate(),a=e.getHours(),h=e.getMinutes(),n=e.getSeconds();return e.getFullYear()+"."+(i<10?"0":"")+i+"."+(s<10?"0":"")+s+" "+(a<10?"0":"")+a+":"+(h<10?"0":"")+h+":"+(n<10?"0":"")+n}(t.unixtime);for(var e=0;e<t.numofz;e++){var i="";switch(t.zones[e].s){case 0:i="OK";break;case-1:i="ErrChecksum";break;case-2:i="ErrTimeout";break;case-3:i="ErrConnect";break;case-4:i="ErrAckL";break;case-5:i="ErrAckH";break;default:i="ErrUnknown"}var s=this.container.querySelector("#arduinocontrol-"+(e+1)+" .temperature > .value");s.innerText=(t.zones[e].t/10).toFixed(1)+"°("+(t.zones[e].tc/10).toFixed(1)+"°)",(s=this.container.querySelector("#arduinocontrol-"+(e+1)+" .humidity > .value")).innerText=(t.zones[e].h/10).toFixed(1)+"%",(s=this.container.querySelector("#arduinocontrol-"+(e+1)+" .sensorstatus")).innerText="Sensor: "+i,s=this.container.querySelector("#arduinocontrol-"+(e+1)+" .pwr"),1==t.zones[e].p?s.className="button active pwr":s.className="button pwr",s=this.container.querySelector("#arduinocontrol-"+(e+1)+" .pwrctrl"),1==t.zones[e].m?s.className="button active pwrctrl":s.className="button pwrctrl"}}redraw(){for(var t=[],e=0,i=0;i<this.diagrams.length;i++){if(this.diagrams[i].rezoom(),e!=this.diagrams[i].tstep){t=[],e=this.diagrams[i].tstep;for(var s=0;s<this.zones.length;s++)t.push(this.zones[s].getzdata(this.ti,e))}this.diagrams[i].redraw(t)}}powercalc(){for(var t=0,e=86400*~~((this.ti.begin+10800)/86400)-10800;e<this.ti.end;e+=86400)for(var i=0;i<this.zones.length;i++)console.log(this.zones[i].array[e]),t+=this.zones[i].array[e].p.integrate(this.ti);return t}}(c+"/log/",g,"controls");console.log(f);var m=new class extends a{constructor(t,e,i){super(t,"H"+e),this.prcolor=i,this.parse=function(t,e,i){var a=new s(t,"ohlc");if(e){for(var h=e.split("\n"),n=0,r=0,o=0;o<h.length;o++){var l=h[o].split(";");if(!(l.length<2))if(128&l[0]){r=0,n=parseInt(l[1]);var u=2;1&l[0]&&(r=parseFloat(l[u++])),r>=0&&r<=5e3&&a.push({flag:1,time:n,value:r/1e3})}else{if(0==n)continue;var c=parseInt(l[1]);(c=c>2147483647?c-4294967296:c)<0&&console.log(c,n,r),n+=c;u=2;1&l[0]&&(r+=parseFloat(l[u++]))>=-1e3&&r<=5e3&&a.push({flag:1,time:n,value:r/1e3})}}0!=a.data.length&&a.push({flag:1,time:n,value:r/1e3})}return a}}}(c+"/log/",0,"#ffa23c"),v=new class extends n{constructor(t,e,i,s,a,h=0,n=40,r=0,o=2){super(e,i,s,a,h,n,r,o),this.hydro=t,this.hydro.onload=p}redraw(){super.redraw();var t=this.hydro.getzdata(this.t,this.tstep);this.graph.y_axis(this.marginleft,25,this.marginleft+this.width+this.marginright,this.height,t.min,t.max,18,"#666666"),this.graph.ohlcbars(this.marginleft,25,this.width,this.height,this.barw,this.barp,t.zdata,t.min,t.max,0,this.hydro.prcolor,this.hydro.prcolor)}}(m,"hydrodiagp",260,160,g);function p(){v.redraw(),f.redraw()}function x(t,e){var i=new XMLHttpRequest;"button active pwrctrl"==t.className?(t.className="button pwrctrl",i.open("GET",c+"/?s"+e+"m:0&r="+1e6*Math.random(),!1),i.send(null)):(t.className="button active pwrctrl",i.open("GET",c+"/?s"+e+"m:1&r="+1e6*Math.random(),!1),i.send(null))}g.onzoom=p,g.onshift=p,p(),window.onclick=function(t){t.target==modal&&(modal.style.display="none")}}]);