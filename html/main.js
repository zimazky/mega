(()=>{"use strict";class t{constructor(t,i="stepped"){this.time=t,this.zmode=i,this.data=[],this.flag=0,this.value=0,this.high=Number.MIN_VALUE,this.low=Number.MAX_VALUE,this.open=0,this.close=0,this.topen=0,this.tclose=0,this.nclose=0,this.tstep=0,this.zdata=[]}push(t){if(!(t.time<this.time))if(0==this.data.length)this.flag=1,this.value=this.low=this.high=this.open=this.close=t.value,this.topen=this.tclose=t.time,this.data.push({flag:0,time:t.time,value:t.value});else{if(this.tclose>this.topen&&(this.value=(this.value*(this.tclose-this.topen)+(this.close-this.open)*(t.time-this.tclose))/(t.time-this.topen)),this.close==t.value&&1==t.flag)return void(0==this.nclose?(this.nclose++,this.tclose=t.time,this.data.push({flag:t.flag,time:t.time,value:t.value})):(this.data[this.data.length-1].time=t.time,this.tclose=t.time));this.low=Math.min(this.low,t.value),this.high=Math.max(this.high,t.value),this.close=t.value,this.tclose=t.time,this.nclose=0,this.data.push({flag:t.flag,time:t.time,value:t.value})}}getlinearregdata(t){for(var i=[],e=this.data[0],s=this.time,a=e.value;s+t<e.time;)i.push({flag:0,value:a}),s+=t;i.push({flag:1,value:a});for(var h=1;h<this.data.length;h++){e=this.data[h];var n=i.length-1,r=this.data[h-1];if(e.time<s+t)i[n].value+=(e.value-a)*(s+t-e.time)/t,a=e.value;else{s+=t;var o=(e.value-r.value)/(e.time-r.time);for(a=r.value+o*(s-r.time);s+t<e.time;){var l=a+o*t;i.push({flag:e.flag,value:(a+l)/2}),a=l,s+=t}i.push({flag:1,value:a})}}return i}getsteppedregdata(t){for(var i=[],e=this.data[0],s=this.time,a=e.value;s+t<e.time;)i.push({flag:0,value:a}),s+=t;i.push({flag:1,value:a});for(var h=1;h<this.data.length;h++){e=this.data[h];var n=i.length-1,r=this.data[h-1];if(e.time<s+t)i[n].value+=(e.value-a)*(s+t-e.time)/t,a=e.value;else{for(s+=t,a=r.value;s+t<e.time;)i.push({flag:e.flag,value:a}),s+=t;0==e.flag&&(a=e.value),i.push({flag:1,value:a})}}return i.push({flag:1,value:a}),i}getohlcregdata(t){for(var i=[],e=this.data[0],s=this.time,a=e.value;s+t<e.time;)i.push({flag:0,open:a,high:a,low:a,close:a}),s+=t;i.push({flag:1,open:a,high:a,low:a,close:a});for(var h=1;h<this.data.length;h++){e=this.data[h];var n=i.length-1,r=this.data[h-1];if(e.time<s+t)i[n].close=e.value,i[n].high=e.value>i[n].high?e.value:i[n].high,i[n].low=e.value<i[n].low?e.value:i[n].low;else{for(s+=t,a=r.value;s+t<e.time;)i.push({flag:e.flag,open:a,high:a,low:a,close:a}),s+=t;0==e.flag&&(a=e.value),i.push({flag:1,open:a,high:a,low:a,close:a})}}return i.push({flag:1,open:a,high:a,low:a,close:a}),i}gethighlowregdata(t){for(var i=[],e=this.data[0],s=this.time,a=e.value;s+t<e.time;)i.push({flag:0,high:a,low:a}),s+=t;i.push({flag:1,high:a,low:a});for(var h=1;h<this.data.length;h++){e=this.data[h];var n=i.length-1,r=this.data[h-1];if(e.time<s+t)i[n].high=e.value>i[n].high?e.value:i[n].high,i[n].low=e.value<i[n].low?e.value:i[n].low;else{for(s+=t,a=r.value;s+t<e.time;)i.push({flag:e.flag,high:a,low:a}),s+=t;0==e.flag&&(a=e.value),i.push({flag:1,high:a,low:a})}}return i.push({flag:1,high:a,low:a}),i}rezoom(t){t<1&&(t=1),this.tstep!=t&&0!=this.data.length&&(this.tstep=t,"linear"==this.zmode?this.zdata=this.getlinearregdata(t):"stepped"==this.zmode?this.zdata=this.getsteppedregdata(t):"highlow"==this.zmode?this.zdata=this.gethighlowregdata(t):"ohlc"==this.zmode&&(this.zdata=this.getohlcregdata(t)))}fillzdata(t,i,e){if(this.tclose<=t.begin||this.topen>=t.end)return e;this.rezoom(i);var s=t.begin,a=~~((t.begin-this.time)/i),h=0;a<0&&(s=this.time,h=-a,a=0);var n=e.min,r=e.max;if("linear"==this.zmode||"stepped"==this.zmode)for(;s<t.end&&s<this.tclose;a++,h++,s+=i){var o=this.zdata[a].flag;e.zdata[h].flag=o;var l=this.zdata[a].value;e.zdata[h].value=l,1==o&&(n=l<n?l:n,r=l>r?l:r)}else if("highlow"==this.zmode)for(;s<t.end&&s<this.tclose;a++,h++,s+=i){o=this.zdata[a].flag,e.zdata[h].flag=o;var u=this.zdata[a].high,g=this.zdata[a].low;e.zdata[h].high=u,e.zdata[h].low=g,1==o&&(n=g<n?g:n,r=u>r?u:r)}else if("ohlc"==this.zmode)for(;s<t.end&&s<this.tclose;a++,h++,s+=i){o=this.zdata[a].flag,e.zdata[h].flag=o;var d=this.zdata[a].open,c=(u=this.zdata[a].high,g=this.zdata[a].low,this.zdata[a].close);e.zdata[h].open=d,e.zdata[h].high=u,e.zdata[h].low=g,e.zdata[h].close=c,1==o&&(n=g<n?g:n,r=u>r?u:r)}return{zdata:e.zdata,min:n,max:r}}integrate(t){var i=0;if(this.data.length>0)for(var e=this.data[0],s=1;s<this.data.length;s++){var a=this.data[s];a.time>t.begin&&a.time<=t.end&&(i+=e.value*(a.time-e.time),e=a)}return i}clearzdata(){this.zdata=[],this.tstep=0}}class i{constructor(t,i){this.url=t,this.ext=i,this.array=[],this.tryes=[],this.parse=function(t,i,e){return{time:t,status:0}},this.onload=function(){},this.ondock=function(t,i){}}load(t,e,s="json"){if(!i.loading&&void 0===this.array[t]){var a=86400*~~((Date.now()/1e3+10800)/86400)-10800;if(!(t>a)){i.loading=!0;var h=new Date(1e3*(t+10800)),n=h.getUTCDate(),r=h.getUTCMonth()+1,o=h.getUTCFullYear(),l=this.url+o+(r<10?"0":"")+r+(n<10?"0":"")+n+"."+this.ext,u=new XMLHttpRequest;u.responseType=s,u.open("GET",l,!0),u.onreadystatechange=function(s){4==u.readyState&&(200==u.status?(this.array[t]=this.parse(t,u.response,e),delete this.tryes[t],void 0!==this.array[t+86400]&&0!=this.array[t+86400].flag&&this.ondock(this.array[t],this.array[t+86400]),void 0!==this.array[t-86400]&&0!=this.array[t-86400].flag&&this.ondock(this.array[t-86400],this.array[t])):0!=u.status?(console.log("loading error",u.statusText),console.log("status",u.status),this.array[t]={flag:0}):(void 0===this.tryes[t]?this.tryes[t]=1:this.tryes[t]+=1,console.log("trying",this.tryes[t]),this.tryes[t]>3&&(this.array[t]={flag:0},delete this.tryes[t])),i.loading=!1,this.onload())}.bind(this),u.send(null),console.log(l)}}}preparezdata(t,i){for(var e=Number.MAX_VALUE,s=Number.MIN_VALUE,a=[],h=t.begin;h<t.end;h+=i)a.push({flag:0});return{zdata:a,min:e,max:s}}getzdata(t,i){for(var e=this.preparezdata(t,i),s=86400*~~((t.begin+10800)/86400)-10800;s<t.end;s+=86400)void 0===this.array[s]?this.load(s,i,"text"):0!=this.array[s].flag&&(e=this.array[s].fillzdata(t,i,e));return e}}function e(t,i=512,e=384){this.container=document.getElementById(t),this._canvas=document.createElement("canvas"),this.container.appendChild(this._canvas),this._canvas.width=i,this._canvas.height=e,this._ctx=this._canvas.getContext("2d"),this.width=this._canvas.width,this.height=this._canvas.height,this.lines=function(t,i,e,s,a,h,n,r,o,l=0,u="black"){var g;if(l<0?(g=-l*(a+h),l=0):(g=l,g=((l=~~(l+.5))-g)*(a+h)),!(g>=e||l>=n.length)){var d=~~((e-g)/(a+h));d=d<n.length-l?d:n.length-l;var c=s/(o-r);this._ctx.save(),this._ctx.strokeStyle=u,this._ctx.beginPath();var m=.5+~~(t+g),v=i+s-c*(n[l].value-r);this._ctx.moveTo(m,.5+~~v),1==n[l].flag?this._ctx.lineTo(m+(a+h),.5+~~v):this._ctx.moveTo(m+(a+h),.5+~~v);for(var f=1;f<d;f++)m=.5+~~(t+g+f*(a+h)),v=i+s-c*(n[l+f].value-r),1==n[l+f].flag&&(1==n[l+f-1].flag||this._ctx.moveTo(m,.5+~~v),this._ctx.lineTo(m+(a+h),.5+~~v));this._ctx.stroke(),this._ctx.restore()}},this.stepped=function(t,i,e,s,a,h,n,r,o,l=0,u="black"){var g;if(l<0?(g=-l*(a+h),l=0):(g=l,g=((l=~~(l+.5))-g)*(a+h)),!(g>=e||l>=n.length)){var d=~~((e-g)/(a+h));d=d<n.length-l?d:n.length-l;var c=s/(o-r);this._ctx.save(),this._ctx.strokeStyle=u,this._ctx.beginPath();var m=.5+~~(t+g),v=i+s-c*(n[l].value-r);this._ctx.moveTo(m,.5+~~v),1==n[l].flag?this._ctx.lineTo(m+(a+h),.5+~~v):this._ctx.moveTo(m+(a+h),.5+~~v);for(var f=1;f<d;f++)m=.5+~~(t+g+f*(a+h)),v=i+s-c*(n[l+f].value-r),1==n[l+f].flag&&(1==n[l+f-1].flag?(this._ctx.lineTo(m,.5+~~v),this._ctx.lineTo(m+(a+h),.5+~~v)):(this._ctx.moveTo(m,.5+~~v),this._ctx.lineTo(m+(a+h),.5+~~v)));this._ctx.stroke(),this._ctx.restore()}},this.ohlcbars=function(t,i,e,s,a,h,n,r,o,l=0,u="green",g="red"){var d;if(l<0?(d=-l*(a+h),l=0):(d=l,d=((l=~~(l+.5))-d)*(a+h)),!(d>=e||l>=n.length)){var c=~~((e-d)/(a+h));c=c<n.length-l?c:n.length-l-1;var m=s/(o-r);this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=u;for(var v=.5+~~(t+d),f=0;f<=c;f++,v+=a+h){var p=i+s-m*(n[l+f].open-r),x=i+s-m*(n[l+f].high-r),z=i+s-m*(n[l+f].low-r),_=i+s-m*(n[l+f].close-r);1==n[l+f].flag&&_<=p&&(this._ctx.moveTo(v,.5+~~_),this._ctx.lineTo(v-(a+h>>1),.5+~~_),this._ctx.moveTo(v-(a+h>>1),.5+~~p),this._ctx.lineTo(v-(a+h),.5+~~p),this._ctx.moveTo(v-(a+h>>1),.5+~~x),this._ctx.lineTo(v-(a+h>>1),.5+~~z))}for(this._ctx.stroke(),this._ctx.beginPath(),this._ctx.strokeStyle=g,v=.5+~~(t+d),f=0;f<=c;f++,v+=a+h)p=i+s-m*(n[l+f].open-r),x=i+s-m*(n[l+f].high-r),z=i+s-m*(n[l+f].low-r),_=i+s-m*(n[l+f].close-r),1==n[l+f].flag&&_>p&&(this._ctx.moveTo(v,.5+~~_),this._ctx.lineTo(v-(a+h>>1),.5+~~_),this._ctx.moveTo(v-(a+h>>1),.5+~~p),this._ctx.lineTo(v-(a+h),.5+~~p),this._ctx.moveTo(v-(a+h>>1),.5+~~x),this._ctx.lineTo(v-(a+h>>1),.5+~~z));this._ctx.stroke(),this._ctx.restore()}},this.highlowbars=function(t,i,e,s,a,h,n,r,o,l=0,u="black"){var g;if(l<0?(g=-l*(a+h),l=0):(g=l,g=((l=~~(l+.5))-g)*(a+h)),!(g>=e||l>=n.length)){var d=~~((e-g)/(a+h));d=d<n.length-l?d:n.length-l-1;var c=s/(o-r);this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=u;for(var m=.5+~~(t+g),v=0;v<=d;v++,m+=a+h){var f=i+s-c*(n[l+v].high-r),p=i+s-c*(n[l+v].low-r);1==n[l+v].flag&&(this._ctx.moveTo(m-(a+h>>1),.5+~~f),this._ctx.lineTo(m-(a+h>>1),.5+~~p))}this._ctx.stroke(),this._ctx.restore()}},this.y_axis=function(t,i,e,s,a,h,n=20,r,o="gray"){var l=(h-a)/(s/n),u=Math.log(l)/Math.log(10);u=u<0?~~(u-1):~~(u+.5);var g=Math.pow(10,u),d=l/g;d<=1?d=1:d<=1.25?(d=1.25,u-=2):d<=2.5?(d=2.5,u--):d<=2?d=2:d<=5?d=5:(d=10,u++),u=u<0?-u:0;var c=g*d,m=c*~~(a/c+1),v=s/(h-a);this._ctx.save(),this._ctx.strokeStyle=r,this._ctx.lineWidth=1,this._ctx.fillStyle=o,this._ctx.font="10px verdana",this._ctx.textAlign="right",this._ctx.textBaseline="bottom";for(var f=m;f<=h;f+=c){var p=.5+~~(i+s-v*(f-a));this._ctx.beginPath(),this._ctx.moveTo(t,p),this._ctx.lineTo(t+e,p),this._ctx.stroke(),this._ctx.fillText(f.toFixed(u),t+e-2,p)}this._ctx.restore()},this.timezone=3,this.timeunits=[{value:1,qt:1,unit:"s",shift:3600*this.timezone},{value:2,qt:1,unit:"s",shift:3600*this.timezone},{value:5,qt:1,unit:"s",shift:3600*this.timezone},{value:10,qt:1,unit:"s",shift:3600*this.timezone},{value:20,qt:1,unit:"s",shift:3600*this.timezone},{value:30,qt:1,unit:"s",shift:3600*this.timezone},{value:60,qt:60,unit:"m",shift:3600*this.timezone},{value:120,qt:60,unit:"m",shift:3600*this.timezone},{value:300,qt:60,unit:"m",shift:3600*this.timezone},{value:600,qt:60,unit:"m",shift:3600*this.timezone},{value:1200,qt:60,unit:"m",shift:3600*this.timezone},{value:1800,qt:60,unit:"m",shift:3600*this.timezone},{value:3600,qt:3600,unit:"h",shift:3600*this.timezone},{value:7200,qt:3600,unit:"h",shift:3600*this.timezone},{value:10800,qt:3600,unit:"h",shift:3600*this.timezone},{value:21600,qt:3600,unit:"h",shift:3600*this.timezone},{value:43200,qt:3600,unit:"h",shift:3600*this.timezone},{value:86400,qt:86400,unit:"d",shift:3600*this.timezone},{value:172800,qt:86400,unit:"d",shift:3600*this.timezone},{value:604800,qt:604800,unit:"w",shift:259200+3600*this.timezone},{value:1209600,qt:604800,unit:"w",shift:259200+3600*this.timezone},{value:2419200,qt:604800,unit:"w",shift:259200+3600*this.timezone}],this.time_grid=function(t,i,e,s,a,h,n=50,r="gray",o="gray"){var l,u=n*(h-a)/e;for(l=0;l<this.timeunits.length&&u>this.timeunits[l].value;l++);l=0==l?0:l-1;var g=this.timeunits[l].value,d=~~((a+this.timeunits[l].shift)/g+1)*g-this.timeunits[l].shift,c=e/(h-a);this._ctx.save(),this._ctx.strokeStyle=r,this._ctx.lineWidth=1,this._ctx.fillStyle=o,this._ctx.font="10px verdana",this._ctx.textBaseline="top";var m=new Date(1e3*(a+3600*this.timezone)),v=m.getUTCHours(),f=m.getUTCDate(),p=m.getUTCMonth()+1,x=m.getUTCFullYear();if("d"==this.timeunits[l].unit||"w"==this.timeunits[l].unit)for(var z=new Date(1e3*(a+3600*this.timezone)),_=0,w=a;w<h;_++){var b=z.getUTCMonth()+1,T=z.getUTCFullYear();z.setUTCHours(0),z.setMinutes(0),z.setSeconds(0),z.setUTCDate(1),z.setUTCMonth(b),b=z.getUTCMonth()+1,T=z.getUTCFullYear();var y=.5+~~(t+((w=z.getTime()/1e3-3600*this.timezone)-a)*c);0==_&&y-t>60&&this._ctx.fillText(x+"."+(p<10?"0":"")+p+"."+(f<10?"0":"")+f,0,0);var U=T+"."+(b<10?"0":"")+b;this._ctx.beginPath(),this._ctx.moveTo(y,i),this._ctx.lineTo(y,i+12),this._ctx.stroke(),this._ctx.fillText(U,y,0)}else if("h"==this.timeunits[l].unit)for(_=0,w=a;w<h;w+=86400,_++){0==_&&(w=86400*~~((a+this.timeunits[l].shift)/86400+1)-this.timeunits[l].shift),y=.5+~~(t+(w-a)*c),0==_&&y-t>60&&this._ctx.fillText(x+"."+(p<10?"0":"")+p+"."+(f<10?"0":"")+f,0,0);var M=(z=new Date(1e3*(w+3600*this.timezone))).getUTCDate();b=z.getUTCMonth()+1,U=(T=z.getUTCFullYear())+"."+(b<10?"0":"")+b+"."+(M<10?"0":"")+M,this._ctx.beginPath(),this._ctx.moveTo(y,i),this._ctx.lineTo(y,i+12),this._ctx.stroke(),this._ctx.fillText(U,y,0)}else if("m"==this.timeunits[l].unit)for(_=0,w=a;w<h;w+=3600,_++){0==_&&(w=3600*~~((a+this.timeunits[l].shift)/3600+1)-this.timeunits[l].shift),y=.5+~~(t+(w-a)*c),0==_&&y-t>95&&this._ctx.fillText(x+"."+(p<10?"0":"")+p+"."+(f<10?"0":"")+f+" "+(v<10?"0":"")+v+":00",0,0);var E=(z=new Date(1e3*(w+3600*this.timezone))).getUTCHours();M=z.getUTCDate(),b=z.getUTCMonth()+1,T=z.getUTCFullYear(),U=(b<10?"0":"")+b+"."+(M<10?"0":"")+M+" "+(E<10?"0":"")+E+"h",this._ctx.beginPath(),this._ctx.moveTo(y,i),this._ctx.lineTo(y,i+12),this._ctx.stroke(),this._ctx.fillText(U,y,0)}for(var C=d;C<h;C+=g)if(y=.5+~~(t+(C-a)*c),this._ctx.beginPath(),this._ctx.moveTo(y,i+12),this._ctx.lineTo(y,i+s),this._ctx.stroke(),z=new Date(1e3*(C+3600*this.timezone)),"s"==this.timeunits[l].unit){var I=z.getUTCSeconds();U=(I<10?"0":"")+I+"''",this._ctx.fillText(U,y,12)}else"m"==this.timeunits[l].unit?(U=((b=z.getUTCMinutes())<10?"0":"")+b+"'",this._ctx.fillText(U,y,12)):"h"==this.timeunits[l].unit?(U=((E=z.getUTCHours())<10?"0":"")+E+"h",this._ctx.fillText(U,y,12)):"d"==this.timeunits[l].unit?(U=((M=z.getUTCDate())<10?"0":"")+M,this._ctx.fillText(U,y,12)):"w"==this.timeunits[l].unit&&(M=z.getUTCDate(),b=z.getUTCMonth()+1,U=(M<10?"0":"")+M,this._ctx.fillText(U,y,12));this._ctx.restore()},this.clear=function(){this._ctx.clearRect(0,0,this.width,this.height)}}i.loading=!1;class s{constructor(t,i,s,a,h=0,n=40,r=0,o=2){this.width=i-h-n,this.height=s-25-0,this.marginleft=h,this.marginright=n,this.barw=r,this.barp=o,this.t=a,this.tstep=(this.t.end-this.t.begin)/this.width*(this.barw+this.barp),this.graph=new e(t,i,s),this.graph._canvas.addEventListener("mousewheel",function(t){t.preventDefault(),t=t||window.event;var i=Math.pow(.9,t.detail?t.detail>0?-1:1:t.wheelDelta>0?1:-1),e=(t.offsetX-this.marginleft)/this.width;this.t.zoom(i,e)}.bind(this),!1),this.isDragging=!1,this.clientX0=0,this.graph._canvas.addEventListener("mousedown",function(t){t.preventDefault(),this.isDragging=!0,this.clientX0=t.offsetX}.bind(this),!1),this.graph._canvas.addEventListener("mousemove",function(t){if(t.preventDefault(),this.isDragging){var i=(t.offsetX-this.clientX0)/(this.barw+this.barp);this.clientX0=t.offsetX,this.t.shift(-i*this.tstep)}}.bind(this),!1),this.graph._canvas.addEventListener("mouseup",function(t){t.preventDefault(),this.isDragging=!1}.bind(this),!1)}rezoom(){this.tstep=(this.t.end-this.t.begin)/this.width*(this.barw+this.barp)}redraw(){this.tstep=(this.t.end-this.t.begin)/this.width*(this.barw+this.barp),this.graph.clear(),this.graph.time_grid(0,0,this.width,this.height+25,this.t.begin,this.t.end,60,"#666666"),this.graph._ctx.save(),this.graph._ctx.fillStyle="grey",this.graph._ctx.font="10px verdana",this.graph._ctx.textBaseline="bottom",this.graph._ctx.restore()}}class a extends i{constructor(i,e,s,a,h){super(i,"Z"+e),this.tcolor=s,this.hcolor=a,this.pcolor=h,this.showpower=!1,this.parse=function(i,e,s){var a=new t(i),h=new t(i),n=new t(i);if(e){for(var r=e.split("\n"),o=0,l=(i=0,0),u=0,g=0,d=0,c=0,m=0,v=0;v<r.length;v++){var f=r[v].split(";");if(!(f.length<2))if(128&f[0]){i=0,l=0,u=0,g=0,c=0,o=parseInt(f[1]);var p=2;1&f[0]&&(i=parseFloat(f[p++])),2&f[0]&&(l=parseFloat(f[p++])),d=4&f[0]?100:0,n.push({flag:1,time:o,value:d}),16&f[0]&&(u=parseFloat(f[p++])),32&f[0]&&(g=parseFloat(f[p++])),64&f[0]&&(c=parseFloat(f[p++])),0==c&&(a.push({flag:0,time:o,value:i/10}),h.push({flag:0,time:o,value:l/10}))}else{if(0==o)continue;var x=parseInt(f[1]);(x=x>2147483647?x-4294967296:x)<0&&console.log(x,o,i,l,u,g,c),o+=x,p=2,1&f[0]&&(i+=parseFloat(f[p++])),2&f[0]&&(l+=parseFloat(f[p++])),4&f[0]?100!=d&&(d=100,n.push({flag:1,time:o,value:d})):0!=d&&(d=0,n.push({flag:1,time:o,value:d})),16&f[0]&&(u+=parseFloat(f[p++])),32&f[0]&&(g+=parseFloat(f[p++])),64&f[0]&&(c=parseFloat(f[p++])),m=0==c?1:0,0==c&&(1&f[0]&&a.push({flag:m,time:o,value:i/10}),2&f[0]&&h.push({flag:m,time:o,value:l/10}))}}0!=a.data.length&&a.push({flag:m,time:o,value:i/10}),0!=h.data.length&&h.push({flag:m,time:o,value:l/10}),0!=n.data.length&&n.push({flag:1,time:o,value:d})}return{t:a,h,p:n}}}preparezdata(t,i){for(var e={zdata:[],min:Number.MAX_VALUE,max:Number.MIN_VALUE},s={zdata:[],min:Number.MAX_VALUE,max:Number.MIN_VALUE},a={zdata:[],min:Number.MAX_VALUE,max:Number.MIN_VALUE},h=t.begin;h<t.end;h+=i)e.zdata.push({flag:0}),s.zdata.push({flag:0}),a.zdata.push({flag:0});return{t:e,h:s,p:a}}getzdata(t,i){for(var e=this.preparezdata(t,i),s=86400*~~((t.begin+10800)/86400)-10800;s<t.end;s+=86400)void 0===this.array[s]?this.load(s,i,"text"):0!=this.array[s].flag&&(e.t=this.array[s].t.fillzdata(t,i,e.t),e.h=this.array[s].h.fillzdata(t,i,e.h),e.p=this.array[s].p.fillzdata(t,i,e.p));return e}}class h extends s{constructor(t,i,e,s,a,h=0,n=40,r=0,o=2){super(i,e,s,a,h,n,r,o),this.zones=t}redraw(t){super.redraw();for(var i=Number.MAX_VALUE,e=Number.MIN_VALUE,s=[],a=0;a<t.length;a++)s.push(t[a]),i=i<s[a].t.min?i:s[a].t.min,e=e>s[a].t.max?e:s[a].t.max;for(this.graph.y_axis(this.marginleft,25,this.marginleft+this.width+this.marginright,this.height,i,e,18,"#666666"),a=0;a<this.zones.length;a++)this.zones[a].showpower&&this.graph.stepped(this.marginleft,25,this.width,this.height,this.barw,this.barp,s[a].p.zdata,0,100,0,this.zones[a].pcolor),this.graph.stepped(this.marginleft,25,this.width,this.height,this.barw,this.barp,s[a].t.zdata,i,e,0,this.zones[a].tcolor)}}class n extends s{constructor(t,i,e,s,a,h=0,n=40,r=0,o=2){super(i,e,s,a,h,n,r,o),this.zones=t}redraw(t){super.redraw();for(var i=Number.MAX_VALUE,e=Number.MIN_VALUE,s=[],a=0;a<t.length;a++)s.push(t[a]),i=i<s[a].h.min?i:s[a].h.min,e=e>s[a].h.max?e:s[a].h.max;for(this.graph.y_axis(this.marginleft,25,this.marginleft+this.width+this.marginright,this.height,i,e,18,"#666666"),a=0;a<this.zones.length;a++)this.zones[a].showpower&&this.graph.stepped(this.marginleft,25,this.width,this.height,this.barw,this.barp,s[a].p.zdata,0,100,0,this.zones[a].pcolor),this.graph.stepped(this.marginleft,25,this.width,this.height,this.barw,this.barp,s[a].h.zdata,i,e,0,this.zones[a].hcolor)}}class r extends s{constructor(t,i,e,s,a,h=0,n=40,r=0,o=2){super(i,e,s,a,h,n,r,o),this.zones=t}abshumiditycalc(t){for(var i=Number.MAX_VALUE,e=Number.MIN_VALUE,s=[],a=0;a<t.h.zdata.length;a++){var h=t.t.zdata[a].flag,n=t.t.zdata[a].value;if(0==h)s.push({flag:0});else{var r=1e6*(n<0?Math.exp((18.74*n-115.72)/(233.77+.881*n)):Math.exp((16.57*n-115.72)/(233.77+.997*n)))/(461.52*(273.15+n));i=i<(r*=.01*t.h.zdata[a].value)?i:r,e=e>r?e:r,s.push({flag:h,value:r})}}return{zdata:s,min:i,max:e}}redraw(t){super.redraw();for(var i=Number.MAX_VALUE,e=Number.MIN_VALUE,s=[],a=0;a<this.zones.length;a++)s.push(this.abshumiditycalc(t[a])),i=i<s[a].min?i:s[a].min,e=e>s[a].max?e:s[a].max;for(this.graph.y_axis(this.marginleft,25,this.marginleft+this.width+this.marginright,this.height,i,e,18,"#666666"),a=0;a<this.zones.length;a++)this.graph.stepped(this.marginleft,25,this.width,this.height,this.barw,this.barp,s[a].zdata,i,e,0,this.zones[a].hcolor)}}var o="http://192.168.2.2";window.addEventListener("load",(function(){setInterval((function(){var t=new Date,i=new Intl.DateTimeFormat("ru",{hour:"numeric",minute:"numeric",second:"numeric"});document.getElementById("time").innerText=i.format(t),i=new Intl.DateTimeFormat("ru",{year:"numeric",month:"long",day:"numeric"}),document.getElementById("date").innerText=i.format(t)}),1e3)}),!1);var l=~~(Date.now()/1e3),u=new class{constructor(t,i,e=function(){},s=function(){}){this.begin=t,this.end=i,this.onshift=e,this.onzoom=s}shift(t){this.begin+=t,this.end+=t,this.onshift()}zoom(t,i=0){if(!(t*(this.end-this.begin)<300)){var e=this.begin+i*(this.end-this.begin);this.begin=e-t*(e-this.begin),this.end=e+t*(this.end-e),this.onzoom()}}}(l-86400,l),g=new class{constructor(t,i,e){this.ti=i,this.url=t,this.container=document.getElementById(e),this.zones=[],this.add_zone(1,"#ffa23c","#bbbbbb","#00C0C0"),this.add_zone(2,"#ffa23c","#bbbbbb","#00C0C0"),this.add_zone(3,"#88a23c","#88bbbb","#00C0C0"),this.diagrams=[],this.diagrams.push(new h(this.zones,"zonediagt",260,160,this.ti)),this.diagrams.push(new n(this.zones,"zonediagh",260,160,this.ti)),this.diagrams.push(new r(this.zones,"zonediagf",260,160,this.ti)),this.getinfo(function(t){var i=this.parseinfo(t);document.getElementById("loading").style.display="none",this.updateinfo(i),setInterval(function(){this.getinfo(function(t){this.updateinfo(this.parseinfo(t))}.bind(this),o)}.bind(this),1e4)}.bind(this),o)}getinfo(t=function(t){},i="."){var e=new XMLHttpRequest;e.open("GET",i+"/?g:i&r="+Math.random(),!0),e.onload=function(){document.getElementById("controllerinfo").innerText=this.responseText,t(this.responseText)},e.send(null)}parseinfo(t){for(var i=t.split(";"),e=parseInt(i[1]),s=[],a=0;a<e;a++){var h=7*a;s[a]={t:parseInt(i[8+h]),tc:parseInt(i[9+h]),h:parseInt(i[10+h]),m:parseInt(i[11+h]),p:parseInt(i[12+h]),dt:parseInt(i[13+h]),s:parseInt(i[14+h])}}return{version:i[0],numofz:e,unixtime:parseInt(i[2]),starttime:parseInt(i[3]),lastsynctime:parseInt(i[4]),lastsyncdelta:parseInt(i[5]),lastsyncinterval:parseInt(i[6]),tickcounter:parseInt(i[7]),zones:s}}add_zone(t,i,e,s){this.zones.push(new a(this.url,t,i,e,s)),this.zones[this.zones.length-1].onload=m,this.container.innerHTML+=`\n\t\t\t<div class="controlbox" id="arduinocontrol-${t}">\n\t\t\t\t<div class="header"><div class="indicator"></div> ZONE ${t}</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class="button pwrctrl" onclick="turnPwrCtrl(this,${t})">PWRCTRL</div>\n\t\t\t\t\t<div class="button pwr">PWR</div>\n\t\t\t\t\t<div class="button">CONFIG</div>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class="button" onclick="turnShowPwr(this,${t})">SHOWPWR</div>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class="parameter temperature button" onclick="modalOpen(this,${t})">\n\t\t\t\t\t\t<div class="name">temperature</div>\n\t\t\t\t\t\t<div class="value">0.0°(0.0°)</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="parameter humidity">\n\t\t\t\t\t\t<div class="name">humidity</div>\n\t\t\t\t\t\t<div class="value">0.0%</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="sensorstatus"></div>\n\t\t\t</div>`}updateinfo(t){document.getElementById("firmware").innerText="ver "+t.version,document.getElementById("controllertime").innerText=function(t){var i=new Date(1e3*t),e=i.getMonth()+1,s=i.getDate(),a=i.getHours(),h=i.getMinutes(),n=i.getSeconds();return i.getFullYear()+"."+(e<10?"0":"")+e+"."+(s<10?"0":"")+s+" "+(a<10?"0":"")+a+":"+(h<10?"0":"")+h+":"+(n<10?"0":"")+n}(t.unixtime);for(var i=0;i<t.numofz;i++){var e="";switch(t.zones[i].s){case 0:e="OK";break;case-1:e="ErrChecksum";break;case-2:e="ErrTimeout";break;case-3:e="ErrConnect";break;case-4:e="ErrAckL";break;case-5:e="ErrAckH";break;default:e="ErrUnknown"}var s=this.container.querySelector("#arduinocontrol-"+(i+1)+" .temperature > .value");s.innerText=(t.zones[i].t/10).toFixed(1)+"°("+(t.zones[i].tc/10).toFixed(1)+"°)",(s=this.container.querySelector("#arduinocontrol-"+(i+1)+" .humidity > .value")).innerText=(t.zones[i].h/10).toFixed(1)+"%",(s=this.container.querySelector("#arduinocontrol-"+(i+1)+" .sensorstatus")).innerText="Sensor: "+e,s=this.container.querySelector("#arduinocontrol-"+(i+1)+" .pwr"),1==t.zones[i].p?s.className="button active pwr":s.className="button pwr",s=this.container.querySelector("#arduinocontrol-"+(i+1)+" .pwrctrl"),1==t.zones[i].m?s.className="button active pwrctrl":s.className="button pwrctrl"}}redraw(){for(var t=[],i=0,e=0;e<this.diagrams.length;e++){if(this.diagrams[e].rezoom(),i!=this.diagrams[e].tstep){t=[],i=this.diagrams[e].tstep;for(var s=0;s<this.zones.length;s++)t.push(this.zones[s].getzdata(this.ti,i))}this.diagrams[e].redraw(t)}}powercalc(){for(var t=0,i=86400*~~((this.ti.begin+10800)/86400)-10800;i<this.ti.end;i+=86400)for(var e=0;e<this.zones.length;e++)console.log(this.zones[e].array[i]),t+=this.zones[e].array[i].p.integrate(this.ti);return t}}("./log/",u,"controls");console.log(g);var d=new class extends i{constructor(i,e,s){super(i,"H"+e),this.prcolor=s,this.parse=function(i,e,s){const a=new t(i,"ohlc");if(e){const t=e.split("\n");let i=0,s=0,h=0;for(let e=0;e<t.length;e++){let n=t[e].split(";");if(!(n.length<2)){if(128&n[0]){s=0,h=0,i=parseInt(n[1]);let t=2;1&n[0]&&(s=parseFloat(n[t++]))}else{if(0==i)continue;let t=parseInt(n[1]);t=t>2147483647?t-4294967296:t,t<0&&console.log(t,i,s),i+=t;let e=2;1&n[0]&&(s+=parseFloat(n[e++]))}h=2&n[0]?5*(s-102.3)/818.4:s/1e3,h>=-1&&h<=5&&a.push({flag:1,time:i,value:h})}}0!=a.data.length&&a.push({flag:1,time:i,value:h})}return a}}}("./log/",0,"#ffa23c"),c=new class extends s{constructor(t,i,e,s,a,h=0,n=40,r=0,o=2){super(i,e,s,a,h,n,r,o),this.hydro=t,this.hydro.onload=m}redraw(){super.redraw();var t=this.hydro.getzdata(this.t,this.tstep);this.graph.y_axis(this.marginleft,25,this.marginleft+this.width+this.marginright,this.height,t.min,t.max,18,"#666666"),this.graph.ohlcbars(this.marginleft,25,this.width,this.height,this.barw,this.barp,t.zdata,t.min,t.max,0,this.hydro.prcolor,this.hydro.prcolor)}}(d,"hydrodiagp",260,160,u);function m(){c.redraw(),g.redraw()}u.onzoom=m,u.onshift=m,m(),window.onclick=function(t){t.target==modal&&(modal.style.display="none")}})();